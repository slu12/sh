// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ./support/utils ../support/utils".split(" "),function(A,B,v,r,t,p,w,x,q){function y(b){return t(this,void 0,void 0,function(){var c,a,f,d,m,n,l,g,k,u,h;return r(this,function(e){switch(e.label){case 0:if(!(b&&b.layer&&b.attributes))throw new p("summary-statistics-for-attributes:missing-parameters","'layer' and 'attributes' parameters are required");
if((c=b.attributes.some(function(a){return!!a.valueExpression}))&&!b.view)throw new p("summary-statistics-for-attributes:missing-parameters","View is required when 'valueExpression' is specified in attributes");a=v({},b);a.includeZeros=null==a.includeZeros||a.includeZeros;a.includeNegatives=null==a.includeNegatives||a.includeNegatives;f=[2,1];d=q.createLayerAdapter(a.layer,f);a.layer=d;if(!d)throw new p("summary-statistics-for-attributes:invalid-parameters","'layer' must be one of these types: "+
q.getLayerTypeLabels(f).join(", "));m=a.view;return[4,w.all([m&&m.when(),d.load()])];case 1:e.sent(),n=[],l=0,g=a.attributes,e.label=2;case 2:if(!(l<g.length))return[3,5];k=g[l];return[4,q.getFieldsList({field:k.field,valueExpression:k.valueExpression})];case 3:u=e.sent(),Array.prototype.push.apply(n,u),e.label=4;case 4:return l++,[3,2];case 5:if(h=x.verifyBasicFieldValidity(d,n,"summary-statistics-for-attributes:invalid-parameters"))throw h;return[2,a]}})})}function z(b,c,a){var f=[],d=[],m=[],n=
[],l=[];b.forEach(function(b,h){var e=b.field?"field":"expression",c=b.field||b.valueExpression;b.field?(l.push(c),d.push("var "+e+h+' \x3d Number($feature["'+c+'"]);')):(f.push("function getValueForExpr"+h+"() {\n  "+c+" \n}"),d.push("var "+e+h+" \x3d Number(getValueForExpr"+h+"());"));a||m.push(""+e+h+" \x3d IIf("+e+h+" \x3c 0, 0, "+e+h+");");n.push(""+e+h)});b="return sum;";var g=f.length?null:l.reduce(function(a,b){return a+" + "+b}),k=null;c||a?c?a||(b="return IIf(sum \x3e\x3d 0, sum, null);",
g&&(k="(( "+g+" ) \x3e\x3d 0)")):(b="return IIf(sum !\x3d 0, sum, null);",g&&(k="(( "+g+" ) \x3c\x3e 0)")):(b="return IIf(sum \x3e 0, sum, null);",g&&(k="(( "+g+" ) \x3e 0)"));return{valueExpression:[f.length?f.join("\n"):"",d.join("\n"),m.join("\n"),"var sum \x3d "+n.join(" + ")+";",b].filter(Boolean).join("\n\n"),sqlExpression:g,sqlWhere:k}}return function(b){return t(this,void 0,void 0,function(){var c,a,f;return r(this,function(d){switch(d.label){case 0:return[4,y(b)];case 1:return c=d.sent(),
a=z(c.attributes,c.includeZeros,c.includeNegatives),f=c.layer,[2,f.summaryStatistics({valueExpression:a.valueExpression,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,view:c.view})]}})})}});