// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators ../../renderers/support/clickToleranceUtils".split(" "),function(t,c,g,e,k,l,q,m,d,r){Object.defineProperty(c,"__esModule",{value:!0});c.MapImageLayerView=function(c){return function(c){function b(){return null!==c&&c.apply(this,arguments)||this}g(b,
c);b.prototype.fetchPopupFeatures=function(c){return l(this,void 0,void 0,function(){var b,d,f,h,e,n,g=this;return k(this,function(p){switch(p.label){case 0:b=this.layer;if(!c)return[2,m.reject(new q("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:b}))];d=this.get("view.scale");f=[];h=function(a){var c=0===a.minScale||d<=a.minScale,b=0===a.maxScale||d>=a.maxScale;a.visible&&c&&b&&(a.sublayers?a.sublayers.forEach(h):a.popupTemplate&&a.popupEnabled&&f.push(a))};b.sublayers.forEach(h);
e=f.map(function(a){return l(g,void 0,void 0,function(){var b,d,e,g;return k(this,function(f){switch(f.label){case 0:return[4,a.popupTemplate.getRequiredFields()];case 1:return b=f.sent(),d=a.createQuery(),e=r.calculateTolerance(a.renderer),d.geometry=this.createFetchPopupFeaturesQueryGeometry(c,e),d.outFields=b,[4,a.queryFeatures(d)];case 2:return g=f.sent(),[2,g.features]}})})});return[4,m.eachAlways(e)];case 1:return n=p.sent(),[2,n.reduce(function(a,b){return a.concat(b.value)},[]).filter(function(a){return null!=
a})]}})})};e([d.property()],b.prototype,"layer",void 0);return b=e([d.subclass("esri.views.layers.MapImageLayerView")],b)}(d.declared(c))}});